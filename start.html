<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

    <title>Tecnologías de Producción de Software</title>
    <link rel="stylesheet" href="./dist/reveal.css" />
    <link rel="stylesheet" href="./dist/theme/white.css" id="theme" />
    <link rel="stylesheet" href="./css/highlight/vs2015.css" />
    <link rel="stylesheet" href="./_assets/node_modules/reveal.js-copycode/plugin/copycode/copycode.css" />
    <link rel="stylesheet" href="./_assets/src/css/styles.css" />

  </head>
  <body>
    <div class="reveal">
      <div class="slides"><section  data-markdown><script type="text/template">
### Tecnologías de Producción de Software

<img class="main" height="250px" src="static/logo.svg" />

# Ruby

<div class="container">
  <div class="col">
    <a href="https://www.info.unlp.edu.ar">
    <img class="main" height="100px" src="static/info-unlp.png" />
    </a>
  </div>
  <div class="col">
    <a href="https://www.unlp.edu.ar">
    <img class="main" height="100px" src="static/unlp.svg" />
    </a>
  </div>
</div></script></section><section ><section data-markdown><script type="text/template">
# Presentación</script></section><section data-markdown><script type="text/template">## La cátedra 

| Profesor | Contacto |
| ---- | --- |
| Lic. Christian A. Rodríguez | [![car@info.unlp.edu.ar](static/mail.svg)](mailto:car@info.unlp.edu.ar "car@info.unlp.edu.ar")<!-- .element: class="social"--> [![twitter](static/twitter.svg)](https://twitter.com/car_unlp "twitter")<!-- .element: class="social"--> [![github](static/github.svg)](https://github.com/chrodriguez "github")<!-- .element: class="social"--> | 

| Jefe de Trabajos Prácticos | Contacto |
| ---- | --- |
| Lic. Nahuel Cuesta Luengo | [![ncuesta@cespi.unlp.edu.ar](static/mail.svg)](mailto:ncuesta@cespi.unlp.edu.ar "ncuesta@cespi.unlp.edu.ar")<!-- .element: class="social"--> [![twitter](static/twitter.svg)](https://twitter.com/ncuestal "twitter")<!-- .element: class="social"--> [![github](static/github.svg)](https://github.com/ncuesta "github")<!-- .element: class="social"--> |

| Ayudantes | Contacto |
| ---- | --- |
|Lic. Patricio Mac Adden | [![patriciomacadden@gmail.com](static/mail.svg)](mailto:patriciomacadden@gmail.com "patriciomacadden@gmail.com")<!-- .element: class="social"--> [![twitter](static/twitter.svg)](https://twitter.com/maxawen "twitter")<!-- .element: class="social"--> [![github](static/github.svg)](https://github.com/patriciomacadden "github")<!-- .element: class="social"--> | 
| Damián Candia | [![dcandia@cespi.unlp.edu.ar](static/mail.svg)](mailto:dcandia@cespi.unlp.edu.ar "dcandia@cespi.unlp.edu.ar")<!-- .element: class="social"--> |
</script></section><section data-markdown><script type="text/template">## Horarios de cursada

| Día | Hora | Aula |
| --- | --- | --- |
| Martes | 11 a 13 | 10-A |
| Jueves | 11 a 13 | 10-A |
</script></section><section data-markdown><script type="text/template"><!-- .slide: data-auto-animate -->
## Programa

Dividimos el programa en cuatro secciones principales:

* **Introducción**
* **El lenguaje**
* **Gemas**
* **Rails**</script></section><section data-markdown><script type="text/template"><!-- .slide: data-auto-animate -->
## Programa

* **Introducción**
  * Se realiza un recorrido rápido acerca de la historia del
  lenguaje.
  * Con ejemplos, mostramos el potencial del lenguaje.
  * Presentamos las diferentes implementaciones de ruby y su instalación.
* **El lenguaje**
* **Gemas**
* **Rails**</script></section><section data-markdown><script type="text/template"><!-- .slide: data-auto-animate -->
## Programa

* **Introducción**
* **El lenguaje**: en esta sección profundizamos sobre el lenguaje:
  * Objetos, arreglos, hashes, símbolos, tipos estándar
  * Estructuras de control
  * Bloques e iteradores
  * E/S estandar
  * Clases de objetos, métodos y variables
  * Módulos y mixins
* **Gemas**
* **Rails**</script></section><section data-markdown><script type="text/template"><!-- .slide: data-auto-animate -->
## Programa

* **Introducción**
* **El lenguaje**
* **Gemas:** a las librerias que extienden Ruby se las llaman Gemas. En esta sección
abordaremos:
  * Manejo de dependencias
  * Bundler
* **Rails**
</script></section><section data-markdown><script type="text/template"><!-- .slide: data-auto-animate -->
## Programa

* **Introducción**
* **El lenguaje**
* **Gemas**
* **Rails:** el framework más utilizado por los desarrolladores Ruby. En esta sección
aprenderemos a trabajar con este framework:
  * Conceptos básicos
  * Ruteo
  * ActiveRecord
  * Unit Testing
  * MVC</script></section><section data-markdown><script type="text/template">## Modalidad de cursada

* **Aprobación de la cursada:** 
  * Una **evaluación o entrega** (estamos definiendo el mejor criterio
    de evaluación) para cada tema. En caso de no
    aprobar algún tema, se podrá reiterar la evaluación de aquellos temas no
    aprobados.
  * **Trabajo práctico final integrador**
* La nota final de la materia será un **seis aprobando la cursada**. Será
  posible mejorar la nota con una extensión del trabajo práctico integrador o
  propuesta de trabajo conjunta con el profesor.
</script></section><section data-markdown><script type="text/template">## Bibliografía / Recursos
A medida que se presenten los temas se indicarán las fuentes apropiadas



<small>

Todo el material se encuentra bajo licencia **Creative Commons**

<span xmlns:dct="https://purl.org/dc/terms/" property="dct:title">TTPS - Opcion Ruby</span> por 
<span xmlns:cc="https://creativecommons.org/ns#" property="cc:attributionName">Christian A. Rodriguez</span> se encuentra bajo
una <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/3.0/deed.es">Licencia Creative Commons Atribución-NoComercial-CompartirIgual 3.0 Unported</a>.
<br />
<a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/3.0/deed.es">
<img alt="Licencia Creative Commons" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/3.0/88x31.png" /></a>

<div>Icons made by <a href="https://www.flaticon.com/authors/pixel-perfect" title="Pixel perfect">Pixel perfect</a> from <a href="https://www.flaticon.com/" title="Flaticon">www.flaticon.com</a></div>

</small>


</script></section></section><section  data-markdown><script type="text/template">
# Introducción

<div class="main-list">

* historia
* el lenguaje
* interpretes
</div>
</script></section><section ><section data-markdown><script type="text/template">
# Historia

<div class="main-list">

* introducción
</div></script></section><section data-markdown><script type="text/template">## [Yukihiro Matsumoto](https://en.wikipedia.org/wiki/Yukihiro_Matsumoto)


<div class="container small">
  <div class="col">

  ![Yukihiro Matsumoto](static/yukihiro-matsumoto.jpg)<!-- .element: class="shade" -->

  </div>
  <div class="col">

  ![Ruby](static/logo.svg)<!-- .element: height="80px" -->
  * En japonés: 松本行弘 (まつもとゆきひろ)
  * Matz más simple
  * Empezó el desarrollo de Ruby en 1993
  * En 1995 lanzó la primera versión
  * Aún lidera el desarrollo de Ruby
  </div>
</div>

<small>

## Su célebre frase

  Ruby is designed to make programmers **HAPPY**

</small>
</script></section><section data-markdown><script type="text/template"><!-- .slide: data-auto-animate -->
## ¿Cómo surge Ruby?

* Fusión de lenguajes
  * Smalltalk
  * Perl
  * LISP
* Hasta el 2001 conocido sólo en Japón
  * El libro [Programming Ruby](https://pragprog.com/book/ruby/programming-ruby) fue el 
    impulsor del lenguaje fuera de Japón
  * También conocido como PickAxe
  * La primera versión puede [leerse en línea](https://ruby-doc.org/docs/ProgrammingRuby/)
</script></section><section data-markdown><script type="text/template"><!-- .slide: data-auto-animate -->
## ¿Cómo surge Ruby?

![pickaxe](static/pickaxe.jpg)<!-- .element: class="shade" height="500px" -->
</script></section><section data-markdown><script type="text/template">## [David Heinemeier Hansson](https://en.wikipedia.org/wiki/David_Heinemeier_Hansson)

<div class="container small">
  <div class="col">

![DHH](static/dhh.jpg)<!-- .element: class="shade"-->

  </div>
  <div class="col">

![Rails](static/rails.svg)<!-- .element: height="80px" -->

  * Creador de [Rails](https://rubyonrails.org/): _framework open source para desarrollo de aplicaciones web_
  * Su primer versión liberada (1.0) fue en 2005

  </div>
</div>



</script></section></section><section ><section data-markdown><script type="text/template">
# El lenguaje

<div class="main-list">

* introducción
</div>
</script></section><section data-markdown><script type="text/template"># El lenguaje

* Dinámico
* Sintaxis concisa y expresiva 
* Orientado a objetos
* Capacidades de metaprogramación
* Características funcionales
</script></section><section data-markdown><script type="text/template">## Sintaxis y convenciones

Nombres válidos y convenciones:

```ruby
  NombreDeClaseOModulo
  CONSTANTE
  @nombre_de_atributo
  @@atributo_de_clase
  $variable_global
  nombre_de_metodo
  metodo_peligroso!
  metodo_que_pregunta?
```
</script></section><section data-markdown><script type="text/template">## Objetos

Todos los valores son **objetos**

```ruby
"Aprendiendo ruby".length
"Aprendiendo ruby".each_char.sort.join
1 + 2
1.send :+, 2
```
## Arreglos

```ruby
["Go", "Ruby", "Java", "Python", "PHP", "Javascript"].sort
([1,2,3] + [4,5,6]).last
```
</script></section><section data-markdown><script type="text/template">

## Números

```ruby
-100.abs
1_123_456 * 1_000_000
1.5 * 3
0b1000_1000   # Binario     =>  136
010           # Octal       =>    8
0x10          # Hexadecimal =>   16
```

<div class="container">
  <div class="col">

### nil

```ruby
a = Array.new
a[10].nil?
nil.nil?
```

  </div>
  <div class="col">

### object id

```ruby
1.object_id
nil.object_id
```
  </div>
</div></script></section><section data-markdown><script type="text/template">
## Strings

<div class="container">
  <div class="col">

### Literales

```ruby
'sin interpolar'
"Interpolando: #{'Ja'*3}!"

# Notación alternativa
%q/Hola/
%q!Chau!
%Q{Interpolando: #{3+3}}
```
  </div>
  <div class="col">

### Here document

```ruby
un_string = <<-EOS
  Este es un texto
  de mas de una linea
  que termina aqui.
  Se puede observar que
  espacios antes de cada
  linea.
EOS

un_string.upcase
```
  </div>
</div>
</script></section><section data-markdown><script type="text/template">## Símbolos

* Son como variables prefijados con **:** (dos puntos)
  * Ejemplos: `:action`, `:line_items`, `:+`
* No es necesario declararlos 
* Se garantiza que son únicos
  * No es necesario asignarles ningún valor

```ruby

:uno.object_id  # siempre devolverá lo mismo
"uno".object_id # siempre devolverá diferente

```</script></section><section data-markdown><script type="text/template">## Colecciones

<div class="container small">
  <div class="col">

### Arreglos

```ruby

['Hola', 'Chau']

# sin interpolar
%w(Hola Chau #{2+2})

# interpolando
%W(Hola Chau #{2+2})

[1,2,3,4]
```

  </div>
  <div class="col">


### Hashes

```ruby
# Versión 1.8
{
  :nombre   => 'Christian',
  :apellido   => 'Rodriguez'
}
# Versión > 1.8
{
  nombre:   'Christian',
  apellido:   'Rodriguez'
}
```

  </div>
</div>
</script></section><section data-markdown><script type="text/template">## Expresiones regulares

```ruby
/^[a-zA-Z]+$/
"Do you like cats?" =~ /like/
"192.168.0.10" =~ /^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/
```


> Explicación en [Pickaxe](https://ruby-doc.com/docs/ProgrammingRuby/html/intro.html#S5).
> Con [Rubular](https://rubular.com/) es posible probarlas.</script></section><section data-markdown><script type="text/template"><div class="container small">
  <div class="col">

## Rangos

```ruby

0..1
0..10
"a".."z"
"a"..."z"

# Pueden convertirse en arreglos
("a"..."z").to_a

# Rangos como intervalos
(1..10) === 5     # => true
(1..10) === 15    # => false
(1..10) === 3.1   # => true

```

  </div>
  <div class="col">

## Expresiones

```
a = 3.14 # => 3.14

# Veamos el case
estado = nil
face =  case estado
        when "Feliz"  then ":)"
        when "Triste" then ":("
        else               ":|"
end

```


> En Ruby toda expresión retorna un valor 

  </div>
</div>
</script></section><section data-markdown><script type="text/template">
<div class="container small">
  <div class="col">

## Lambdas

```ruby
uno = lambda { |n| n * 2 }
dos = ->(n, m){ n * 2 + m }
tres  = ->(n, m=0){ n * 2 + m}

# Entonces

uno.call 2      # => 4
dos.call 2,3    # => 7
tres.call 2     # => 4
```
  </div>
  <div class="col">

## Bloques


```ruby
3.times do |i|
  puts i
end

3.times { |i| puts i }
```

> Rara vez usaremos un for / while

  </div>
</div></script></section><section data-markdown><script type="text/template"><!-- .slide: data-auto-animate -->
## Ejemplos de bloques y colecciones


<pre data-id="code-animation"><code class="ruby hljs" data-trim data-line-numbers>
# Selección de números pares
(1..10).select { |n| n.even? }

# Procesar cada elemento de una colección
(1..10).map { |n| n*2 }

# Calcular con los elementos de la colección:
(1..100).reduce { |sum,n| sum + n }
</code></pre>


</script></section><section data-markdown><script type="text/template"><!-- .slide: data-auto-animate -->
## Ejemplos de bloques y colecciones

<pre data-id="code-animation"><code class="ruby hljs" data-trim data-line-numbers="3,4,8,9,13,14">
# Selección de números pares
(1..10).select { |n| n.even? }
# o lo que es igual:
(1..10).select(& :even?)

# Procesar cada elemento de una colección
(1..10).map { |n| n*2 }
# o lo que es igual:
(1..10).collect { |n| n*2 }

# Calcular con los elementos de la colección:
(1..100).reduce { |sum,n| sum + n }
# o lo que es igual:
(1..100).reduce(:+)
</code></pre>
</script></section><section data-markdown><script type="text/template">## Bloques y archivos

```ruby

File.open('/etc/passwd').each do |line|
  puts line if line =~ /root/
end
```


</script></section></section><section ><section data-markdown><script type="text/template">
# Intérpretes

<div class="main-list">

* introducción
</div>
</script></section><section data-markdown><script type="text/template">
Ruby como lenguaje, tiene varias implementaciones. La implementación de
referencia es conocida como **MRI: _Matz’s Ruby Interpreter_** o **CRuby**
(porque está desarrollada en C), pero existen otras implementaciones.
</script></section><section data-markdown><script type="text/template">
## MRI

* **Homepage:** https://www.ruby-lang.org/
* Matz' Ruby Implementation
* También llamada CRuby
* Es la implementación de referencia del lenguaje
* Versiones
  * **1.8.x**
  * **1.9.x**
  * **2.x**
  * Ruby 3 will be 3 times faster <!-- .element: class="fragment" -->
</script></section><section data-markdown><script type="text/template">## JRuby


* **Homepage:** https://www.jruby.org/
* Ruby en la **JVM de Java**
* Es la alternativa más madura a MRI en términos de compatibilidad con MRI
* Ventajas:
  * Concurrencia real
  * Interoperabilidad con librerías Java

<img src="static/jruby.png" height="200" />
</script></section><section data-markdown><script type="text/template">## Rubinius

* **Homepage:** https://github.com/rubinius/rubinius
* Comenzó como un experimento que comenzó como una implementación de Ruby, pero
  en realidad apunta a extender las limitaciones de Ruby.
* Su diseño se enfoca en la concurrencia.
* La VM fue escrita en C++
</script></section><section data-markdown><script type="text/template">## TruffleRuby

* **Homepage:** https://github.com/oracle/truffleruby
* Es una implementación de alta performance de Ruby creada por Oracle.
* Permite correr código en paralelo y el startup de aplicaciones ruby es mucho
  menor.
* Basado en [GraalVM](http://graalvm.org/). 

<img src="static/truffleruby.png" height="200" /></script></section><section data-markdown><script type="text/template">## ¿Cómo trabajar con ruby?

* Mayormente la gestión del ambiente de trabajo con ruby se realiza con alguna
  de las siguientes herramientas:
  * [**RVM:** Ruby Version Manager](https://rvm.io/)
  * [**rbenv:** Ruby environment](https://github.com/rbenv/rbenv)
  * _Ruby instalado como paquete del propio sistema no es recomendado._

> El uso, instalación y manejo de los entornos serán abordados en el espacio de
> las prácticas




</script></section></section><section  data-markdown><script type="text/template">
# Ruby

<div class="main-list">

* objetos y atributos
* clases
* variables
* colecciones
* bloques e iteradores
* módulos
* excepciones
* conceptos avanzados (ex slide-09)
</div>
</script></section><section ><section data-markdown><script type="text/template">
## Objetos y atributos

<div class="main-list">

* ruby

</div>
</script></section><section data-markdown><script type="text/template">## Aprendemos con un ejemplo

* Sistema que realiza control de stock de libros.
* Utilizando un lector de código de barra se lee de cada libro información que
  luego se descargará como CSV
* Ejemplo del CSV:

```csv
"Date","ISBN","Amount"
"2008-04-12","978-1-9343561-0-4",39.45
"2008-04-13","978-1-9343561-6-6",45.67
"2008-04-14","978-1-9343560-7-4",36.95
```
</script></section><section data-markdown><script type="text/template">## ¿Qué debe hacer el sistema?

* Leer varios archivos CSV y determinar cuántos ejemplares de cada
  título disponemos
* Determinar además el monto total en libros que tenemos
</script></section><section data-markdown><script type="text/template">## Creamos la clase BookInStock


```ruby
class BookInStock
end
```
> Recordamos que los nombres de las clases deben comenzar con mayúsculas, los
métodos con minúscula

<div class="fragment" >

### Lo probamos

```ruby
a_book = BookInStock.new
another_book = BookInStock.new
```
</div>
</script></section><section data-markdown><script type="text/template">## Observaciones

* Se crean dos objetos diferentes de la clase `BookInStock`. 
* Podríamos decir en esta primer instancia que son el mismo libro, o iguales porque **nada los
distingue**.
* Lo solucionamos obligando que la inicialización indique aquellos datos que distinga al
libro.
</script></section><section data-markdown><script type="text/template">
## Variables de instancia

```ruby
class BookInStock
  def initialize(isbn, price)
    @isbn = isbn
    @price = Float(price)
  end
end
```

* El método `initialize` es especial en Ruby 
* Cuando se invoca el método `new`, Ruby aloca memoria para alojar un objeto no
  inicializado y luego invoca al método `initialize` **pasándole cada parámetro
  que fue enviado a `new`**.
* Entonces `initialize` nos permite configurar el estado inicial de nuestros objetos.
</script></section><section data-markdown><script type="text/template">## En el método initialize

* Se utilizan variables de instancia: comienzan con **@**.
* Las variables `@isbn` e `isbn` son diferentes.
* Se realiza una pequeña validación implícita:
  * El método [`Float`](http://www.ruby-doc.org/core-2.0.0/Kernel.html#method-i-Float)
    toma un argumento y lo convierte a `float`, terminando el programa si falla
    la conversión</script></section><section data-markdown><script type="text/template">
## Usamos los nuevos objetos

```ruby
b1 = BookInStock.new("isbn1", 3)
p b1
b2 = BookInStock.new("isbn2", 3.14)
p b2
b3 = BookInStock.new("isbn3", "5.67")
p b3
```

> Usamos el método `p` porque imprime el estado interno de los objetos.
> Si se utilizara `puts` entonces se invocaría `to_s` e imprimiría:
> `#<nombre_de_clase:id_objeto_en_hex>`
</script></section><section data-markdown><script type="text/template">
## Implementamos to_s

```ruby
class BookInStock
  def to_s
    "ISBN: #{@isbn}, price: #{@price}"
  end
end
```

> Probar nuevamente `puts b3`</script></section><section data-markdown><script type="text/template">## Objetos y sus atributos

* Un objeto como el mostrado anteriormente no permite que nadie acceda a sus
  variables.
* Si bien es algo positivo encapsular, si no permitimos acceder a los datos que
  mantienen el estado del objeto, el mismo se vuelve inútil.
* A las *ventanas* de acceso a los objetos las denominaremos **atributos**.
* Modificaremos nuestra clase de `BookInStock` con el fin de agregar atributos
  para `isbn` y `price` así podemos contabilizarlos.
</script></section><section data-markdown><script type="text/template">## Getters

```ruby
class BookInStock
  def isbn
    @isbn 
  end

  def price
    @price
  end
end
```
</script></section><section data-markdown><script type="text/template">## Atributos de lectura

A los atributos anteriores se los denomina **accesor** porque mapean
directamente con las variables de instancia. Ruby provee un shortcut: **`attr_reader`**.

```ruby 
class BookInStock
  attr_reader :isbn, :price
  def initialize(isbn, price)
    @isbn = isbn
    @price = Float(price)
  end
end
```

> * Notar que se utilizan **símbolos**.
> * `attr_reader` **no define variables de instancia**, sólo los métodos de acceso.
</script></section><section data-markdown><script type="text/template">## Atributos de escritura

No sólo leemos atributos: a veces necesitamos modificar un valor. Ésto es
posible definiendo un método terminado con **el signo igual**.

```ruby
class BookInStock
  attr_reader :isbn, :price

  def initialize(isbn, price)
    @isbn = isbn
    @price = Float(price)
  end

  def price=(new_price)
    @price = new_price
  end
end
```
</script></section><section data-markdown><script type="text/template">## Atributos de escritura

```ruby
book = BookInStock.new("isbn1", 33.80)
book.price = book.price * 0.75 # discount price
puts "New price = #{book.price}"
```

<div class="container">

<div class="col small">

Podemos usar entonces:
* **`attr_writer`:** acceso W.
* **`attr_accessor`:** acceso RW.

</div>
<div class="col">


```ruby
class BookInStock

  attr_reader :isbn
  attr_accessor :price

  def initialize(isbn, price)
    @isbn = isbn
    @price = Float(price)
  end
end
```

</div>
</div></script></section><section data-markdown><script type="text/template">## Atributos virtuales

Agregamos el precio en centavos

<pre><code class="ruby hljs" data-trim data-line-numbers="10-16">
class BookInStock
  attr_reader :isbn
  attr_accessor :price
  def initialize(isbn, price)
    @isbn = isbn
    @price = Float(price)
  end

  def price_in_cents
    Integer(price*100 + 0.5)
  end

  def price_in_cents=(cents)
    @price = cents / 100.0
  end
end
</pre></code>
</script></section><section data-markdown><script type="text/template">## El lector de CSV
Ya tenemos el objeto que representa un libro. Resta implementar:
* Leer varios archivos CSV
* Totalizar ejemplares iguales
* Totalizar el precio de los libros en stock
</script></section><section data-markdown><script type="text/template">## CsvReader

Pensamos la estructura de `CsvReader`
```ruby
class CsvReader
  def initialize
  end

  def read_in_csv_data(csv_file_name)
  end

  def total_value_in_stock
  end

  def number_of_each_isbn
  end
end
```</script></section><section data-markdown><script type="text/template">## Uso de CsvReader

```ruby
reader = CsvReader.new
reader.read_in_csv_data("file1.csv")
reader.read_in_csv_data("file2.csv")
# Otros csv
puts "Total value in stock =  #{reader.total_value_in_stock}"
```

* Notamos que `CsvReader` debe ir acumulando lo que va leyendo de cada csv.
* Para ello mantendremos un arreglo de valores como variable de instancia.
* Para leer un CSV, Ruby provee de una librería que simplificará el trabajo.
</script></section><section data-markdown><script type="text/template">
## CsvReader

```ruby
require 'csv'

class CsvReader

  def initialize
    @books_in_stock = []
  end

  def read_in_csv_data(csv_file_name)
    CSV.foreach(csv_file_name, headers: true) do |row|
      @books_in_stock << 
        BookInStock.new(row["ISBN"], row["Amount"])
    end
  end
end
```
> Utilizamos la librería `csv` que nos permite acceder a los campos de cada
> columna por su nombre.
</script></section><section data-markdown><script type="text/template">## Cálculo  del precio total

```ruby
class CsvReader

  def total_value_in_stock
    sum = 0.0
    @books_in_stock.each do |book| 
      sum += book.price
    end
    sum
  end

end
```

> Ya veremos una implementación **más rubista** que la utilizada en esta
> instancia.
</script></section><section data-markdown><script type="text/template">
## Organizando el código

* Dividimos el código en tres archivos
  * **`lib/book_in_stock.rb`:** la clase `BookInStock`
  * **`lib/csv_reader.rb`:** el código de `CsvReader`
  * **`stock_stats.rb`:** el programa principal
* Aparecerán dependencias entre ellos
  * Para cargar dependencias externas se utiliza: **`require`** y **`require_relative`**
</script></section><section data-markdown><script type="text/template">
### stock_stats.rb

```ruby
require_relative 'csv_reader'

reader = CsvReader.new
ARGV.each do |csv_file_name|
  STDERR.puts "Processing #{csv_file_name}"
  reader.read_in_csv_data(csv_file_name)
end

puts "Total value = #{reader.total_value_in_stock}"
```

[Descargar el
ejemplo](https://github.com/chrodriguez/ttps-ruby/tree/master/ejemplos/stock-stats)





</script></section></section></div>
    </div>

    <script src="./dist/reveal.js"></script>

    <script src="./plugin/markdown/markdown.js"></script>
    <script src="./plugin/highlight/highlight.js"></script>
    <script src="./plugin/zoom/zoom.js"></script>
    <script src="./plugin/notes/notes.js"></script>
    <script src="./plugin/math/math.js"></script>
    <script>
      function extend() {
        var target = {};
        for (var i = 0; i < arguments.length; i++) {
          var source = arguments[i];
          for (var key in source) {
            if (source.hasOwnProperty(key)) {
              target[key] = source[key];
            }
          }
        }
        return target;
      }

      // default options to init reveal.js
      var defaultOptions = {
        controls: true,
        progress: true,
        history: true,
        center: true,
        transition: 'default', // none/fade/slide/convex/concave/zoom
        plugins: [
          RevealMarkdown,
          RevealHighlight,
          RevealZoom,
          RevealNotes,
          RevealMath
        ]
      };

      // options from URL query string
      var queryOptions = Reveal().getQueryHash() || {};

      var options = extend(defaultOptions, {"transition":"slide"}, queryOptions);
    </script>

    <script src="./_assets/src/js/clipboard.min.js"></script>
    <script src="./_assets/node_modules/reveal.js-copycode/plugin/copycode/copycode.js"></script>
    <script src="./_assets/src/js/custom.js"></script>

    <script>
      Reveal.initialize(options);
    </script>
  </body>
</html>
